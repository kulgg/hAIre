---
import SentenceList from "../../../components/SentenceList.astro";
import applications, {
	Application,
	ScoredSentence,
} from "../../../data/applications";
import AuthedLayout from "../../../layouts/AuthedLayout.astro";

const { id } = Astro.params;

export interface Props {
	application: Application;
}

const { application } = Astro.props;

export async function getStaticPaths() {
	return applications.map((application) => ({
		params: { id: application.id },
		props: { application },
	}));
}

const grammarScore = application.data.grammarScore;
const grammarScorePercentage = grammarScore * 100;

const { skills, education, pastWork } = application.data.content;

const accumulatorFunction = (
	acc: number,
	curr: ScoredSentence,
	negative: boolean
): number => {
	return acc + (negative ? 0.5 - curr.score : 0.5 + curr.score);
};

const totalScore =
	(grammarScore +
		skills.positiveSentences.reduce(
			(acc, curr) => accumulatorFunction(acc, curr, false),
			0
		) +
		skills.negativeSentences.reduce(
			(acc, curr) => accumulatorFunction(acc, curr, true),
			0
		) +
		education.positiveSentences.reduce(
			(acc, curr) => accumulatorFunction(acc, curr, false),
			0
		) +
		education.negativeSentences.reduce(
			(acc, curr) => accumulatorFunction(acc, curr, true),
			0
		) +
		pastWork.positiveSentences.reduce(
			(acc, curr) => accumulatorFunction(acc, curr, false),
			0
		) +
		pastWork.negativeSentences.reduce(
			(acc, curr) => accumulatorFunction(acc, curr, true),
			0
		)) /
	(1 +
		skills.positiveSentences.length +
		skills.negativeSentences.length +
		education.positiveSentences.length +
		education.negativeSentences.length +
		pastWork.positiveSentences.length +
		pastWork.negativeSentences.length);

const totalScorePercentage = totalScore * 100;
---

<AuthedLayout stakeholder="Staff">
	<div class="mx-10">
		<h2 class="text-xl mt-5 text-primary">Application #{id}</h2>
		<div class="flex flex-col w-full py-4">
			<div class="text-xl">Grammar and spelling</div>
			<div class="flex items-center gap-5">
				<progress
					class={`progress ${
						grammarScorePercentage < 60
							? "progress-warning"
							: "progress-success"
					}`}
					value={grammarScorePercentage}
					max="100"></progress>
				<div>{grammarScorePercentage}%</div>
			</div>
			<div class="divider"></div>
			<div>
				<h2 class="text-xl">Content</h2>
				<SentenceList sentences={skills} title="Skills" />
				<SentenceList sentences={education} title="Education" />
				<SentenceList sentences={pastWork} title="Past Work" />
			</div>
			<div class="divider"></div>
			<div class="card w-full bg-base-100 self-center shadow-xl">
				<div class="card-body">
					<h2 class="card-title">Likely a good hire</h2>
					<span class=""
						>{totalScorePercentage.toFixed(0)}% overall applicant score</span
					>
					<progress
						class="progress progress-info w-full"
						value={totalScorePercentage}
						max="100"></progress>
					<div class="card-actions justify-center gap-24 px-10 mt-5">
						<a class="btn btn-success" href="/staff/success">Accept</a>
						<a class="btn" href="/staff/success">Reject</a>
					</div>
				</div>
			</div>
		</div>
	</div>
</AuthedLayout>
